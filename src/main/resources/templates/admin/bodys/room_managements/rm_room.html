<th:block layout:fragment="content" layout:decorate="~{admin/layouts/index}">
    <div class="vstack gap-3">
        <h3>Quản lý phòng</h3>
        <hr>
        <div class="border rounded-3 shadow bg-light p-3">
            <div class="hstack gap-3 mb-3" id="reduce-room">
                <!-- code ở dưới script -->
            </div>

            <div class="hstack gap-3 d-flex justify-content-between">
                <div class="hstack gap-4 w-50">
                    <div class="btn-group w-25">
                        <button class="btn btn-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Tầng (8)
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Tất cả</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#">Tầng 1</a></li>
                            <li><a class="dropdown-item" href="#">Tầng 2</a></li>
                            <li><a class="dropdown-item" href="#">Tầng 3</a></li>
                            <li><a class="dropdown-item" href="#">Tầng 4</a></li>
                            <li><a class="dropdown-item" href="#">Tầng 5</a></li>
                            <li><a class="dropdown-item" href="#">Tầng 6</a></li>
                        </ul>
                    </div>
                    <div class="btn-group  w-25">
                        <button class="btn btn-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Loại phòng (6)
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Tất cả</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#">Another action</a></li>
                            <li><a class="dropdown-item" href="#">Something else here</a></li>
                            <li><a class="dropdown-item" href="#">Separated link</a></li>
                        </ul>
                    </div>
                    <div class="btn-group w-25">
                        <button class="btn btn-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Sắp xếp
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Tất cả</a></li>
                            <li><a class="dropdown-item" href="#">Tầng 1</a></li>
                            <li><a class="dropdown-item" href="#">Tầng 2</a></li>
                            <li><a class="dropdown-item" href="#">Tầng 3</a></li>
                            <li><a class="dropdown-item" href="#">Tầng 4</a></li>
                            <li><a class="dropdown-item" href="#">Tầng 5</a></li>
                            <li><a class="dropdown-item" href="#">Tầng 6</a></li>
                        </ul>
                    </div>
                    <div class="btn-group  w-25">
                        <button class="btn btn-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Chiều
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Tăng dần</a></li>
                            <li><a class="dropdown-item" href="#">Giảm dần</a></li>
                        </ul>
                    </div>
                </div>
                <form class="input-group" id="form-search" style="width: 40%;" required>
                    <input type="hidden" name="sortField" th:value="${sortField}">
                    <input type="hidden" name="sortDir" th:value="${sortDir}">
                    <input type="text" class="form-control form-control-sm" placeholder="Tìm kiếm ..."
                        aria-label="Recipient's username" aria-describedby="button-addon2" name="keyword"
                        th:value="${keyword}">
                    <button class="btn btn-outline-primary btn-sm" type="submit">
                        <i class="fa fa-search" aria-hidden="true"></i>
                    </button>
                </form>
            </div>
        </div>
        <hr>
        <div class="mb-3 p-3 border shadow rounded-3">
            <div class="row g-4 mb-3" id="table-room">
                <!-- code ở script -->
            </div>

            <!-- Xử lý phân trang -->
            <div class="hstack gap-3 d-flex justify-content-between">
                <p>Số trang: [[${totalPage}]] - Số phòng: [[${totalElement}]] - Hiện tại: [[${currentPage}]] - Sắp xếp:
                    [[${sortField}]] - Chiều: [[${sortDir}]]</p>
                <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-end">
                        <li class="page-item disabled" th:if="${currentPage == 1}">
                            <a class="page-link"
                                th:href="@{'/admin/internal-managements/account/page/1?sortField=id&sortDir='+${sortDir}+'&keyword='}">
                                <i class="fa fa-angle-double-left" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li class="page-item" th:unless="${currentPage == 1}">
                            <a class="page-link"
                                th:href="@{'/admin/internal-managements/account/page/1?sortField=id&sortDir='+${sortDir}+'&keyword='}">
                                <i class="fa fa-angle-double-left" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li class="page-item disabled" th:if="${currentPage == 1}">
                            <a class="page-link"
                                th:href="@{'/admin/internal-managements/account/page/'+${currentPage-1}+'?sortField=id&sortDir='+${sortDir}+'&keyword='}">
                                <i class="fa fa-angle-left" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li class="page-item" th:unless="${currentPage == 1}">
                            <a class="page-link"
                                th:href="@{'/admin/internal-managements/account/page/'+${currentPage-1}+'?sortField=id&sortDir='+${sortDir}+'&keyword='}">
                                <i class="fa fa-angle-left" aria-hidden="true"></i>
                            </a>
                        </li>
                        <th:block th:each="i : ${#numbers.sequence(1, totalPage)}">
                            <li class="page-item active" th:if="${currentPage == i}">
                                <span class="page-link">[[${i}]]</span>
                            </li>
                            <li class="page-item" th:unless="${currentPage == i}">
                                <a class="page-link"
                                    th:href="@{'/admin/internal-managements/account/page/'+${i}+'?sortField=id&sortDir='+${sortDir}+'&keyword='}">[[${i}]]</a>
                            </li>
                        </th:block>
                        <li class="page-item disabled" th:if="${currentPage == totalPage}">
                            <a class="page-link"
                                th:href="@{'/admin/internal-managements/account/page/'+${currentPage+1}+'?sortField=id&sortDir='+${sortDir}+'&keyword='}">
                                <i class="fa fa-angle-right" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li class="page-item" th:unless="${currentPage == totalPage}">
                            <a class="page-link"
                                th:href="@{'/admin/internal-managements/account/page/'+${currentPage+1}+'?sortField=id&sortDir='+${sortDir}+'&keyword='}">
                                <i class="fa fa-angle-right" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li class="page-item disabled" th:if="${currentPage == totalPage}">
                            <a class="page-link"
                                th:href="@{'/admin/internal-managements/account/page/'+${totalPage}+'?sortField=id&sortDir='+${sortDir}+'&keyword='}">
                                <i class="fa fa-angle-double-right" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li class="page-item" th:unless="${currentPage == totalPage}">
                            <a class="page-link"
                                th:href="@{'/admin/internal-managements/account/page/'+${totalPage}+'?sortField=id&sortDir='+${sortDir}+'&keyword='}">
                                <i class="fa fa-angle-double-right" aria-hidden="true"></i>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>


    </div>

    <script>
        var $ = document.querySelector.bind(document)
        var $$ = document.querySelectorAll.bind(document)

        var tableRoom = $('#table-room')
        var reduceRoom = $('#reduce-room')

        fetch('http://localhost:8081/api/room', {
            method: 'GET',
        })
            .then(resp => resp.json())
            .then(rooms => {
                var countEmpty = countRepair = countUsing = countCheckin = countCheckout = countDeposit = 0
                var features = ''

                rooms.map((room, i) => {
                    var roomState = ''
                    if (room.roomState == 'EMPTY') {
                        colorState = '#0d6efd'
                        countEmpty++
                        features = `
                        <a class="btn btn-outline-dark btn-sm text-light" href="#" title="đặt"><i class="fa fa-plus" aria-hidden="true"></i></a>
                        <a class="btn btn-outline-dark btn-sm text-light" href="#" title="checkin"><i class="fa fa-sign-in" aria-hidden="true"></i></a>
                        `
                    } else if (room.roomState == 'REPAIR') {
                        colorState = '#6c757d'
                        countRepair++
                        features = ``
                    } else if (room.roomState == 'USING') {
                        colorState = '#198754'
                        countUsing++
                        features = `
                        <a class="btn btn-outline-dark btn-sm text-light" href="#" title="checkout"><i class="fa fa-sign-out"
                            aria-hidden="true"></i></a>
                        <a class="btn btn-outline-dark btn-sm text-light" href="#" title="dịch vụ"><i class="fa fa-diamond"
                            aria-hidden="true"></i></a>
                        `
                    } else if (room.roomState == 'CHECKIN') {
                        colorState = '#087990'
                        countCheckin++
                        features = `
                        <a class="btn btn-outline-dark btn-sm text-light" href="#" title="đặt"><i class="fa fa-plus" aria-hidden="true"></i></a>
                        <a class="btn btn-outline-dark btn-sm text-light" href="#" title="hủy"><i class="fa fa-ban" aria-hidden="true"></i></a>
                        `
                    } else if (room.roomState == 'CHECKOUT') {
                        colorState = '#984c0c'
                        countCheckout++
                        features = `
                        <a class="btn btn-outline-dark btn-sm text-light" href="#" title="đặt"><i class="fa fa-plus" aria-hidden="true"></i></a>
                        <a class="btn btn-outline-dark btn-sm text-light" href="#" title="hủy"><i class="fa fa-ban" aria-hidden="true"></i></a>
                        `
                    } else if (room.roomState == 'DEPOSIT') {
                        colorState = '#8540f5'
                        countDeposit++
                        features = `
                        <a class="btn btn-outline-dark btn-sm text-light" href="#" title="checkin"><i class="fa fa-sign-in"
                            aria-hidden="true"></i></a>
                        <a class="btn btn-outline-dark btn-sm text-light" href="#" title="hủy"><i class="fa fa-ban" aria-hidden="true"></i></a>
                        `
                    }

                    tableRoom.innerHTML += `
                    <div class="col-2">
                        <div class="border rounded-3 vstack gap text-center p-2"
                            style="font-size: 14px; color: white; background-color: ${colorState}; min-height: 260px;">
                            <div class="hstack  d-flex justify-content-between">
                                ${i}
                                <div class="hstack gap-1">
                                    <a class="btn btn-outline-dark btn-sm text-light" href="#"><i class="fa fa-refresh"
                                            aria-hidden="true"></i></a>
                                    <a class="btn btn-outline-dark btn-sm text-light" href="#"><i class="fa fa-floppy-o"
                                            aria-hidden="true"></i></a>
                                </div>
                            </div>
                            <h5>${room.id}</h5>
                            <p class="">${room.roomState}</p>
                            <p class="">Bao Nguyen</p>
                            <p class=""><i class="fa fa-calendar" aria-hidden="true"></i> 2021-08-24 17:56:12.212</p>
                            <p class=""><i class="fa fa-calendar" aria-hidden="true"></i> 2021-08-28 17:56:12.212</p>
                            <div class="hstack gap-3 d-flex justify-content-center">
                                ${features}
                            </div>
                        </div>
                    </div>
                `
                })

                reduceRoom.innerHTML += `
                <a href="#" class="btn text-light text-center border rounded-3 p-2 w-25 fs-6" style="background-color: #0d6efd">Trống: ${countEmpty}</a>
                <a href="#" class="btn text-light text-center border rounded-3 p-2 w-25 fs-6" style="background-color: #198754">Đang ở: ${countUsing}</a>
                <a href="#" class="btn text-light text-center border rounded-3 p-2 w-25 fs-6" style="background-color: #8540f5">Đặt cọc: ${countDeposit}</a>
                <a href="#" class="btn text-light text-center border rounded-3 p-2 w-25 fs-6" style="background-color: #087990">Checkin: ${countCheckin}</a>
                <a href="#" class="btn text-light text-center border rounded-3 p-2 w-25 fs-6" style="background-color: #984c0c">Checkout: ${countCheckout}</a>
                <a href="#" class="btn text-light text-center border rounded-3 p-2 w-25 fs-6" style="background-color: #6c757d">Sửa chữa: ${countRepair}</a>
                    `
            })
    </script>
</th:block>