<th:block layout:fragment="content" layout:decorate="~{admin/layouts/index}">
    <form class="container" id="form-invoice" enctype="multipart/form-data">

        <h3 class="text-primary fw-bolder text-uppercase">CHI TIẾT HÓA ĐƠN</h3>

        <hr>
        <div class="hstack gap-3">
            <div class="vstack gap-3" style="width: 35%">
                <div class="border p-3 rounded-3 bg-light shadow">
                    <h3 class="text-decoration-underline">CHI TIẾT HÓA ĐƠN</h3>
                    <h5>Phòng được chọn</h5>
                    <p>Mã hóa đơn: [[${invoice.id}]]</p>
                    <input type="hidden" th:value="${invoice.id}" name="id-invoice">
                    <div class="hstack gap-3 mt-4">
                        <div style="width: 40%">
                            <a href="#">
                                <img style="width: 100%" th:src="${room_type.logo}" alt="">
                            </a>
                        </div>
                        <div style="width: 60%" class="align-self-start">
                            <h4>[[${room_type.name}]]</h4>
                            <p>$ [[${room_type.price}]]/ Đêm</p>
                        </div>
                    </div>
                    <div class="vstack gap-3 mt-4">
                        <div class="hstack gap-3 d-flex justify-content-between">
                            <p class="fw-bold">Ngày đặt phòng</p>
                            <p th:text="${#dates.format(invoice.startDate, 'dd-MM-yyyy')}"></p>
                        </div>
                        <div class="hstack gap-3 d-flex justify-content-between">
                            <p class="fw-bold">Ngày trả phòng</p>
                            <p th:text="${#dates.format(invoice.endDate, 'dd-MM-yyyy')}"></p>
                        </div>
                        <div class="hstack gap-3 d-flex justify-content-between">
                            <p class="fw-bold">Người lớn</p>
                            <p>[[${invoice.adults}]]</p>
                        </div>
                        <div class="hstack gap-3 d-flex justify-content-between">
                            <p class="fw-bold">Trẻ em</p>
                            <p>[[${invoice.children}]]</p>
                        </div>
                        <div class="hstack gap-3 d-flex justify-content-between">
                            <p class="fw-bold">Loại phòng</p>
                            <p>[[${COUNT_ROOM}]] x [[${room_type.name}]]</p>
                        </div>

                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Tên</th>
                                    <th scope="col">Tầng</th>
                                    <th scope="col" class="text-end">Giá thêm</th>
                                </tr>
                            </thead>
                            <tbody>
                                <th:block th:each="room, state : ${rooms}">
                                    <tr>
                                        <th scope="row">[[${state.count}]]</th>
                                        <td>[[${room.name}]]</td>
                                        <td class="text-center">[[${room.floor}]]</td>
                                        <td class="text-end">[[${room.priceIncurred}]] $</td>
                                    </tr>
                                </th:block>
                            </tbody>
                            <tfooter>
                                <tr>
                                    <td class="text-start" colspan="3">Tổng</td>
                                    <td class="text-end">[[${TOTAL_PRICE_INCURRED}]] $</td>
                                </tr>
                            </tfooter>
                        </table>


                        <hr>
                        <div class="hstack gap-3 d-flex justify-content-between">
                            <p class="fw-bold">Giá phòng</p>
                            <p>[[${room_type.price}]]$</p>
                        </div>
                        <div class="hstack gap-3 d-flex justify-content-between">
                            <p class="fw-bold">Dịch vụ</p>
                            <p>15-10-2019</p>
                        </div>
                        <div class="hstack gap-3 d-flex justify-content-between">
                            <p class="fw-bold">Mã giảm giá</p>
                            <p>Không có</p>
                        </div>
                        <div class="hstack gap-3 d-flex justify-content-between">
                            <input type="text" class="form-control form-control-sm">
                            <button class="btn btn-primary btn-sm" style="min-width: 100px;">Áp dụng</button>
                        </div>
                        <hr>
                        <div class="hstack gap-3 d-flex justify-content-between">
                            <p class="fw-bold">Tổng</p>
                            <p>[[${TOTAL_PRICE}]] $</p>
                        </div>
                        <div class="hstack gap-3 d-flex justify-content-between">
                            <p class="fw-bold">Phí dịch vụ: (5%)</p>
                            <p>[[${PRICE_SERVICE_5P}]] $</p>
                        </div>
                        <div class="hstack gap-3 d-flex justify-content-between">
                            <p class="fw-bold">VAT: (10%)</p>
                            <p>[[${PRICE_VAT_10P}]] $</p>
                        </div>
                        <div class="hstack gap-3 d-flex justify-content-between">
                            <p class="fw-bold">Tổng tiền</p>
                            <p>[[${TOTAL_PRICE_ALL}]] $</p>
                        </div>
                    </div>
                </div>
                <div class="vstack gap-3 border p-3 rounded-3 shadow bg-light">
                    <h3 class="text-decoration-underline">GIỎ HÀNG DỊCH VỤ</h3>
                    <ol class="list-group list-group-numbered mt-3" id="services-cart">
                        <li class="list-group-item d-flex justify-content-between align-items-start" id="test">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">Subheading</div>
                                <span class="badge bg-primary rounded-pill">14</span> x 20.5$
                            </div>
                            <button type="button" class="btn-close" aria-label="Close"></button>
                        </li>
                    </ol>
                </div>
            </div>
            <div class="vstack gap-3 p-3 border rounded bg-light" style="width: 65%">
                <div>
                    <h3 class="text-decoration-underline">Dịch vụ</h3>
                    <h5 class="mt-4">Danh sách các dịch vụ hỗ trợ khách hàng</h5>
                    <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt
                        ut
                        laoreet dolore magna aliquam erat volutpat.</p>

                    <th:block th:each="service, state : ${services}">
                        <div class="hstack gap-1 border p-2 service-box">
                            <a href="#" style="width: 25%" class="align-self-start">
                                <img style="width: 160px" th:src="${service.image}" alt="${service.name}">
                            </a>
                            <div style="width: 75%" class="align-self-start">
                                <h6>[[${service.name}]]</h6>
                                <div class="hstack gap-1 d-flex align-items-center">
                                    <input class="form-control form-control-sm" type="number" style="width: 15%" min="0"
                                        max="10" id="num-service">
                                    <p style="margin-bottom: 0px">[[${service.price}]]$</p>
                                </div>
                                <p style="font-size: 12px;">[[${service.description}]]</p>
                            </div>
                        </div>
                    </th:block>

                </div>
                <div>
                    <h3 class="text-decoration-underline">THÔNG TIN KHÁCH HÀNG</h3>

                    <div class="d-flex justify-content-center">
                        <a href="#">
                            <img style="width: 200px;" class="rounded-circle my-4" th:src="${account.getAvatar()}"
                                alt="">
                        </a>
                    </div>

                    <input type="hidden" id="id-account" name="id-account" th:value="${account.id}">

                    <div class="hstack gap-3">
                        <div class="form-floating w-50">
                            <input type="text" class="form-control" id="name" placeholder="Họ & tên" name="name"
                                required th:value="${account != null} ? ${account.name} : ''">
                            <label for="name">Họ & tên</label>
                            <p class="text-danger text-center" id="name-message" style="font-size: 12px"></p>
                        </div>
                        <div class="form-floating w-50">
                            <input type="text" class="form-control" id="address" placeholder="Địa chỉ" name="address"
                                required th:value="${account != null} ? ${account.address} : ''">
                            <label for="address">Địa chỉ</label>
                            <p class="text-danger text-center" id="address-message" style="font-size: 12px"></p>
                        </div>
                    </div>

                    <div class="hstack gap-3">
                        <div class="form-floating w-50">
                            <input type="email" class="form-control" id="email" name="email"
                                placeholder="name@gmail.com" required
                                th:value="${account != null} ? ${account.email} : ''">
                            <label for="email">Email</label>
                            <p class="text-danger text-center" id="email-message" style="font-size: 12px"></p>
                        </div>
                        <div class="form-floating w-50">
                            <input type="text" class="form-control" id="phoneNum" placeholder="Số điện thoại"
                                name="phoneNum" required th:value="${account != null} ? ${account.phoneNum} : ''">
                            <label for="phoneNum">Số điện thoại</label>
                            <p class="text-danger text-center" id="phoneNum-message" style="font-size: 12px"></p>
                        </div>
                    </div>

                    <div class="hstack gap-3">
                        <div class="form-floating w-50">
                            <input type="date" class="form-control" id="birthday" placeholder="Ngày sinh"
                                name="birthday"
                                th:value="${account != null} ? ${#dates.format(account.birthday, 'yyyy-MM-dd')} : ''">
                            <label for="birthday">Ngày sinh</label>
                            <p class="text-danger text-center" id="birthday-message" style="font-size: 12px"></p>
                        </div>
                        <div class=" form-floating w-50">
                            <input id="account-gender" type="hidden"
                                th:value="${account != null} ? ${account.gender} : ''">
                            <select class="form-select form-select-gender" id="gender"
                                aria-label="Floating label select example" name="gender">
                                <option value="">Chọn giới tính</option>
                                <option value="true">Nam</option>
                                <option value="false">Nữ</option>
                            </select>
                            <label for="gender">Giới tính</label>
                            <p class="text-danger text-center" id="gender-message" style="font-size: 12px"></p>
                        </div>
                    </div>

                    <div class="vstack gap-3">
                        <label for="editor2">Thông tin riêng</label>
                        <textarea class="form-control" style="height: 100px" name="editor1" id="editor1"></textarea>
                    </div>

                    <hr>

                    <div>
                        <h3 class="text-decoration-underline mb-4">ĐÁNH GIÁ</h3>

                        <div class="overflow-auto" style="height: 400px;">
                            <th:block th:each="i : ${#numbers.sequence(1, 5)}">
                                <div class="list-group">
                                    <div class="list-group-item list-group-item-action hstack gap-3"
                                        aria-current="true">
                                        <img class="rounded-circle" style="width: 80px;"
                                            src="https://hoc24.vn/images/avt/avt6384329_256by256.jpg" alt="">
                                        <div class=" w-100">
                                            <div class="d-flex w-100 justify-content-between">
                                                <h5 class="mb-1">Lee Min Hoo</h5>
                                                <small>3 days ago</small>
                                            </div>
                                            <p class="mb-1">Phòng rộng sạch đẹp Thoáng mát, xứng đáng 5 sao nhé :))</p>
                                            <div class="text-warning">
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                                <i class="fa fa-star-half-o" aria-hidden="true"></i>
                                                <i class="fa fa-star-o" aria-hidden="true"></i>
                                            </div>
                                        </div>
                                    </div>
                            </th:block>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <script>
        CKEDITOR.replace('editor1')
        var $ = document.querySelector.bind(document)
        var $$ = document.querySelectorAll.bind(document)

        var numServices = Array.from($$('#num-service'))

        var formSelectgender = $('.form-select-gender')
        var accountGender = $('#account-gender')

        if (accountGender.value == 'true') {
            formSelectgender.selectedIndex = '1'
        } else if (accountGender.value == 'false') {
            formSelectgender.selectedIndex = '2'
        }

        //Tạo hàm gọi api
        function fetchAPI(url, method, body) {
            fetch(url, {
                method: method,
                body: body
            })
                .then(resp => {
                    if (resp.status === 200) {
                        if (resp.redirected) {
                            window.location.href = resp.url;
                        }
                    } else {
                        alert("Fail Validate!")
                    }
                })
                .catch(err => {
                    alert("Error!")
                })
        }

        var formInvoice = $('#form-invoice')
        var btnDeleteInvoice = $('#btn-delete-invoice')

        btnDeleteInvoice.addEventListener('click', (e) => {
            e.preventDefault()
            var k = confirm('Bạn muốn xóa hóa đơn này không?')
            if (k) {
                var formData = new FormData(formInvoice);
                var ids = [];

                ids.push(formData.get('id-invoice'))

                formData.append('invoice', new Blob([JSON.stringify({
                    'ids': ids,
                    'idAccount': formData.get('id-customer'),
                })], { type: 'application/json' }))

                fetchAPI(`/home/checkin/handle-del-invoice`, 'DELETE', formData)
            } else return
        })

    </script>
</th:block>